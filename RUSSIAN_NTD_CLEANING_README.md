# Реструктуризация Базы НТД в Bldr Empire v2

## Обзор

Этот документ описывает процесс реструктуризации базы нормативно-технической документации (НТД) в Bldr Empire v2. Система автоматически сканирует, очищает и обновляет базу НТД, обеспечивая актуальность и структурированность данных.

## Структура Проекта

```
c:\Bldr\
├── core\
│   ├── norms_scan.py          # Сканирование существующей базы НТД
│   ├── norms_processor.py      # Обработка и реструктуризация документов
│   ├── celery_norms.py        # Асинхронные задачи обновления НТД
│   └── bldr_api.py            # API endpoints для управления НТД
├── run_clean.py               # Скрипт для запуска полного процесса очистки
└── web\bldr_dashboard\src\components\
    └── ProFeatures.advanced.letter.tsx  # UI для управления НТД
```

## Процесс Реструктуризации

### 1. Сканирование Базы (norms_scan.py)

Сканирует существующую базу НТД для идентификации дубликатов и устаревших документов:

- Подсчитывает общее количество файлов
- Находит дубликаты по хэшу содержимого файлов
- Идентифицирует устаревшие документы по дате
- Категоризирует документы по типам (строительство, финансы, безопасность и т.д.)

### 2. Обработка и Реструктуризация (norms_processor.py)

Обрабатывает документы для создания чистой, структурированной базы:

- Удаляет дубликаты, оставляя самые новые версии
- Организует файлы по категориям в структурированную папку
- Импортирует метаданные документов в Neo4j (:NormDoc nodes)

### 3. Обновление из Официальных Источников (celery_norms.py)

Асинхронно обновляет документы из официальных источников:

- Проверяет наличие новых/обновленных документов
- Скачивает недостающие документы
- Обновляет статус документов (актуальный/устаревший)
- Архивирует старые версии

### 4. Запуск Процесса Очистки (run_clean.py)

Запускает полный процесс очистки базы НТД:

```bash
python run_clean.py
```

## API Endpoints

### Получение Списка НТД
```
GET /norms-list
Параметры:
- category (опционально): construction, finance, safety, ecology, hr, other
- status (опционально): actual, outdated, pending
- type (опционально): mandatory, recommended, methodical, textbook
- search (опционально): поиск по ID или названию
- page (по умолчанию 1): номер страницы
- limit (по умолчанию 50): количество записей на странице
```

### Обновление НТД
```
POST /norms-update
Тело:
- categories (опционально): список категорий для обновления
- force (по умолчанию false): принудительное обновление
```

### Экспорт НТД
```
GET /norms-export
Параметры:
- format: csv или excel
- category, status, type, search: фильтры (аналогично /norms-list)
```

### Сводка по НТД
```
GET /norms-summary
Возвращает общее количество документов по статусам
```

## Пользовательский Интерфейс

UI для управления НТД доступен в разделе "Управление Нормами" в ProFeatures. Интерфейс предоставляет:

- Таблицу с перечнем всех НТД
- Фильтры по категории, типу и статусу
- Поиск по ID или названию
- Экспорт в CSV/Excel
- Кнопку обновления перечня

## Типы Документов

- **Обязательная НТД**: СП, ГОСТ, ФЗ и другие обязательные документы
- **Рекомендуемая НТД**: Рекомендации и руководящие документы
- **Методическая литература**: Методики, инструкции, руководства
- **Учебники**: Учебная литература и пособия

## Статусы Документов

- **Актуальная**: Проверена и подтверждена как актуальная
- **Устаревшая**: Имеется более новая версия
- **На проверке**: Требует проверки актуальности

## Автоматическое Обучение RAG

После обновления базы НТД система автоматически запускает обучение RAG на новой базе для обеспечения актуальности поиска и анализа.

## Резервное Копирование

Перед началом процесса очистки система автоматически создает резервную копию исходной базы в папке `I:/docs/backup_YYYYMMDD_HHMMSS`.

## Требования

- Python 3.8+
- Neo4j database
- Доступ к официальным источникам НТД (minstroyrf.ru, gosstandart.gov.ru, consultant.ru, garantru etc.)
- Установленные зависимости из requirements.txt