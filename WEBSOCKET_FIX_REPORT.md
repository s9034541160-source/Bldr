# üîß –û–¢–ß–ï–¢ –û–ë –ò–°–ü–†–ê–í–õ–ï–ù–ò–ò WEBSOCKET

## ‚úÖ –ü–†–û–ë–õ–ï–ú–ê –†–ï–®–ï–ù–ê –£–°–ü–ï–®–ù–û!

### üéØ **–ü–†–û–ë–õ–ï–ú–ê:**
```
WebSocket connection attempt from Address(host='127.0.0.1', port=57522)
Token from query params: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Invalid token: Signature has expired
INFO: connection rejected (403 Forbidden)
```

### üîß **–†–ï–ê–õ–ò–ó–û–í–ê–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:**

#### 1. **–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞**
**–§–∞–π–ª:** `main.py`
**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** 
```python
# –ë—ã–ª–æ: 30 –º–∏–Ω—É—Ç
ACCESS_TOKEN_EXPIRE_MINUTES = int(os.getenv("ACCESS_TOKEN_EXPIRE_MINUTES", "30"))

# –°—Ç–∞–ª–æ: 24 —á–∞—Å–∞  
ACCESS_TOKEN_EXPIRE_MINUTES = int(os.getenv("ACCESS_TOKEN_EXPIRE_MINUTES", "1440"))
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –¢–æ–∫–µ–Ω—ã —Ç–µ–ø–µ—Ä—å –∂–∏–≤—É—Ç 24 —á–∞—Å–∞ –≤–º–µ—Å—Ç–æ 30 –º–∏–Ω—É—Ç

#### 2. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ WebSocket**
**–§–∞–π–ª:** `main.py`
**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
```python
except jwt.ExpiredSignatureError as e:
    # Token expired, provide helpful message
    print(f"Token expired: {e}")
    await websocket.close(code=4003, reason="Token expired. Please refresh the page to get a new token.")
except jwt.PyJWTError as e:
    # Invalid token, reject connection
    print(f"Invalid token: {e}")
    await websocket.close(code=4003, reason="Invalid token. Please refresh the page to get a new token.")
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –≤–º–µ—Å—Ç–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –¥–µ—Ç–∞–ª–µ–π

#### 3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ**
**–§–∞–π–ª:** `web/bldr_dashboard/src/components/AuthHeader.tsx`

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `refreshToken()` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è –∑–∞ 5 –º–∏–Ω—É—Ç –¥–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚úÖ Fallback –Ω–∞ –ø–µ—Ä–µ–ª–æ–≥–∏–Ω –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ —Ç–µ—Ä—è—é—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Ç–æ–∫–µ–Ω–∞

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

### ‚úÖ **–í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´:**

1. **üîê –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞:** ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–æ –¥–æ 24 —á–∞—Å–æ–≤
2. **üîß –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ WS:** ‚úÖ –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
3. **üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞:** ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
4. **üé´ –°–æ–∑–¥–∞–Ω–∏–µ JWT:** ‚úÖ –¢–æ–∫–µ–Ω—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### üöÄ **–ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê –ù–û–í–û–ô –°–ò–°–¢–ï–ú–´:**

#### 1. **–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —Å–µ—Å—Å–∏–∏**
- **–ë—ã–ª–æ:** –¢–æ–∫–µ–Ω –∏—Å—Ç–µ–∫–∞–ª —á–µ—Ä–µ–∑ 30 –º–∏–Ω—É—Ç
- **–°—Ç–∞–ª–æ:** –¢–æ–∫–µ–Ω –∂–∏–≤–µ—Ç 24 —á–∞—Å–∞
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ —Ç–µ—Ä—è—é—Ç —Å–µ—Å—Å–∏—é –≤ —Ç–µ—á–µ–Ω–∏–µ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è

#### 2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ**
- **–ë—ã–ª–æ:** –ü—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Ç–æ–∫–µ–Ω–∞ - –æ—à–∏–±–∫–∞ 403
- **–°—Ç–∞–ª–æ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ë–µ—Å—à–æ–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏

#### 3. **–ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö**
- **–ë—ã–ª–æ:** `Invalid token: Signature has expired`
- **–°—Ç–∞–ª–æ:** `Token expired. Please refresh the page to get a new token.`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–Ω–∏–º–∞—é—Ç, —á—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

#### 4. **–ü—Ä–æ–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**
- **–ë—ã–ª–æ:** –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏
- **–°—Ç–∞–ª–æ:** –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞ 5 –º–∏–Ω—É—Ç –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Ä–∞–∑—Ä—ã–≤–æ–≤ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- ‚úÖ `main.py` - —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞ –∏ —É–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ `web/bldr_dashboard/src/components/AuthHeader.tsx` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞

### –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- ‚úÖ `refreshToken()` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è –∑–∞ 5 –º–∏–Ω—É—Ç –¥–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `jwt.ExpiredSignatureError`

### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:
1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞** –ø—Ä–∏ –∫–∞–∂–¥–æ–º WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏
2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** –∑–∞ 5 –º–∏–Ω—É—Ç –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è
3. **–ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è** –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
4. **Fallback –Ω–∞ –ø–µ—Ä–µ–ª–æ–≥–∏–Ω** –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏

## üéâ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–ü–†–û–ë–õ–ï–ú–ê –° WEBSOCKET –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–®–ï–ù–ê!**

‚úÖ **–¢–æ–∫–µ–Ω—ã –∂–∏–≤—É—Ç 24 —á–∞—Å–∞** –≤–º–µ—Å—Ç–æ 30 –º–∏–Ω—É—Ç  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è  
‚úÖ **–ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è** –æ–± –æ—à–∏–±–∫–∞—Ö  
‚úÖ **–ü—Ä–æ–∞–∫—Ç–∏–≤–Ω–∞—è –∑–∞—â–∏—Ç–∞** –æ—Ç —Ä–∞–∑—Ä—ã–≤–æ–≤ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è  

–¢–µ–ø–µ—Ä—å WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ —Å—Ç–∞–ª–∫–∏–≤–∞—é—Ç—Å—è —Å –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–º–∏ —Ä–∞–∑—Ä—ã–≤–∞–º–∏!

**–°—Ç–∞—Ç—É—Å:** üéØ **–ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–í–ï–†–®–ï–ù–û**
