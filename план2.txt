# BLDR.EMPIRE: Верхнеуровневая архитектура системы управления строительными проектами

## 1. Общая концепция

**BLDR.EMPIRE** — это комплексная система управления строительными проектами, объединяющая передовые технологии ИИ с глубокой специализацией на российском строительном законодательстве, нормативной базе и бизнес-процессах. Система построена вокруг **локально развернутых дообученных LLM-моделей**, которые служат "мозгом" приложения, обрабатывающего более 109 бизнес-процессов строительной организации.

**Ключевые принципы архитектуры:**
- **Локальность и автономность** — все ИИ-модели работают на инфраструктуре заказчика, без зависимости от внешних API
- **Глубокая специализация** — модели дообучены на уникальной базе российских строительных, финансовых и юридических документов
- **Процессно-ориентированность** — архитектура отражает реальную структуру строительного бизнеса (9 функциональных блоков, 109 процессов)
- **Двойной подход к знаниям** — комбинация дообученных LLM (основной механизм) и RAG (резервный/контрольный)
- **Единая информационная среда** — все документы, данные и процессы интегрированы в единую СОД

## 2. Архитектурные слои

### 2.1. Представительский слой (Frontend Layer)
- **Основной интерфейс** — React + TypeScript + Ant Design
- **Мобильный интерфейс** — адаптивная версия + PWA
- **Telegram-бот** — для уведомлений, согласований, сбора данных
- **Email-интеграция** — автоматическая отправка документов и отчетов

### 2.2. API-слой
- **REST API** (FastAPI) — для основных операций
- **WebSocket** — для реального времени (уведомления, мониторинг)
- **GraphQL** — для сложных запросов к данным
- **Аутентификация** — JWT + RBAC

### 2.3. Ядро системы (Core Layer)
- **Координатор** — управляет взаимодействием агентов и инструментов
- **Система инструментов** — 47+ инструментов для автоматизации процессов
- **RAG-система** — резервный/контрольный механизм получения знаний
- **Менеджер моделей** — управление загрузкой и кэшированием LLM
- **Система памяти** — краткосрочная и долгосрочная память для контекста

### 2.4. Слой данных (Data Layer)
- **Neo4j** — графовая БД для взаимосвязей (проекты, документы, процессы)
- **Qdrant** — векторное хранилище для RAG
- **PostgreSQL** — основная реляционная БД
- **Redis** — кэширование и очередь задач
- **MinIO/S3** — хранилище файлов с версионированием

## 3. Ключевые модули и компоненты

### 3.1. Модуль управления знаниями
- **DeepSeek-OCR от Unsloth** — для извлечения текста из PDF-документов
- **Генератор Q-A пар** — автоматическое создание обучающих примеров
- **Unsloth-тренер** — интерфейс для дообучения GGUF-моделей
- **Валидатор знаний** — контроль качества и соответствия нормативам
- **RAG-резерв** — механизм для проверки результатов основных моделей

### 3.2. Модуль СОД (Среда Общих Данных)
- **Версионирование документов** — полная история изменений для каждого файла
- **Метаданные** — автоматическая классификация документов по ГОСТ 21.101-2020
- **Права доступа** — гибкая система разграничения прав по ролям и проектам
- **Поиск и индексация** — полнотекстовый и семантический поиск
- **Интеграция с 1С** — синхронизация данных с основной ERP-системой

### 3.3. Модуль ЭДО (Электронный Документооборот)
- **Шаблоны документов** — 150+ унифицированных форм (ОС-1, КС-2, КС-3, ППР и др.)
- **Сбор подписей** — интеграция с КриптоПро для наложения ЭЦП
- **Согласование** — настраиваемые BPMN-процессы
- **Уведомления** — через Telegram, email, внутри системы
- **История согласований** — полный аудит всех действий

### 3.4. Аналитический модуль
- **Финансовый анализ** — расчет NPV, IRR, сметной стоимости, бюджета
- **Планирование ресурсов** — распределение по бригадам, материалам, технике
- **Визуализация** — диаграммы Ганта, критический путь, дашборды
- **Прогнозирование** — ML-модели для оценки рисков и отклонений
- **Отчетность** — автоматическая генерация отчетов по всем процессам

## 4. Архитектура ИИ-компонента

### 4.1. Модельная стратегия
- **Основная модель** — дообученная GGUF-модель на базе DeepSeek (7B+) с фокусом на строительную специфику
- **Специализированные модели** — отдельные модели для финансовых расчетов, юридического анализа, BIM
- **Гибридный подход** — основные задачи решает дообученная модель, RAG используется для:
  - Проверки актуальности информации
  - Поиска конкретных нормативов
  - Работы с совсем новыми документами (пока модель не переобучена)

### 4.2. Пайплайн дообучения
1. **Сбор данных** — извлечение текста из ГОСТ, СНиП, СП через DeepSeek-OCR
2. **Подготовка данных**:
   - Очистка от шума
   - Структурирование по разделам
   - Генерация Q-A пар
3. **Настройка обучения**:
   - Выбор базовой модели
   - Настройка параметров Unsloth (LoRA, 4-bit квантование)
   - Определение метрик качества
4. **Обучение и валидация**:
   - Обучение с мониторингом
   - Тестирование на контрольных вопросах
   - Сравнение с "золотыми" ответами от экспертов
5. **Деплоймент**:
   - Конвертация в GGUF
   - Интеграция в систему
   - Тестирование в продакшен-сценариях

## 5. План реализации (этапы)

### Этап 1: Фундамент (1-2 месяца)
- Настройка инфраструктуры для локальных моделей
- Развертывание DeepSeek-OCR
- Создание базовой архитектуры СОД
- Реализация модуля для дообучения моделей (Unsloth UI)
- Интеграция с 1С (базовые API)

### Этап 2: Ядро ИИ и критические процессы (2-3 месяца)
- Дообучение базовых моделей на ключевых документах
- Автоматизация первых 6 ключевых процессов:
  - F1.01: Инициация проекта
  - F1.02: Предпроектное ТЭО
  - F1.07: Разработка календарного плана
  - F2.04: Создание спецификаций (ВоМ)
  - F4.01: Формирование задания на смену
  - F5.01: Планирование денежных потоков
- Реализация базового ЭДО (согласование, ЭЦП)
- Интеграция с Telegram-ботом

### Этап 3: Расширение и оптимизация (3-4 месяца)
- Автоматизация следующих 30+ процессов
- Доработка специализированных моделей под конкретные задачи
- Оптимизация производительности LLM на локальном оборудовании
- Расширенная аналитика и визуализация
- Мобильные приложения для полевых работ

### Этап 4: Масштабирование (4-6 месяцев)
- Полная автоматизация всех 109 процессов
- Расширенная интеграция с внешними системами
- Платформа для партнерских интеграций
- Экспорт решений для других строительных компаний

## 6. Технологический стек

### 6.1. Backend
- **Основа**: Python 3.10+, FastAPI
- **ML/ИИ**: Unsloth, Transformers, GGUF runtime
- **Базы данных**: Neo4j, PostgreSQL, Qdrant, Redis
- **Очереди**: Celery + RabbitMQ
- **Файловое хранилище**: MinIO (S3-совместимое)
- **OCR**: DeepSeek-OCR от Unsloth

### 6.2. Frontend
- **Основа**: React 18, TypeScript
- **UI**: Ant Design, Tailwind CSS
- **Визуализация**: D3.js, Gantt Chart libraries
- **Состояние**: Zustand/Jotai
- **WebSocket**: Socket.IO

### 6.3. DevOps
- **Контейнеризация**: Docker, Docker Compose
- **Оркестрация**: Kubernetes (для продакшена)
- **CI/CD**: GitHub Actions
- **Мониторинг**: Prometheus + Grafana
- **Логирование**: ELK Stack

## 7. Особенности архитектуры

### 7.1. Гибридный подход к знаниям
- **Основной путь**: Дообученная GGUF-модель отвечает на запросы
- **Контрольный путь**: RAG проверяет ответы модели на соответствие актуальным документам
- **Фолбэк**: Если модель не уверена в ответе, используется RAG + пометка "требуется проверка экспертом"

### 7.2. Процессно-ориентированная структура
Система организована не вокруг документов или отделов, а вокруг конкретных бизнес-процессов:
- Каждый процесс (F1.01, F4.08 и т.д.) имеет свой шаблон автоматизации
- Модульная архитектура позволяет добавлять/изменять процессы без переписывания системы
- Все процессы имеют измеримые KPI и SLA

### 7.3. Двухуровневая система безопасности
- **Уровень данных**: Шифрование, RBAC, аудит действий
- **Уровень ИИ**: Валидация ответов моделей, фильтрация галлюцинаций, контроль выходных данных

## 8. Интеграционные точки

### 8.1. Внутренние системы
- Интеграция с 1С (ДО, ЗУП, Бухгалтерия)
- Телеграм-бот для уведомлений и сбора данных
- MS Project (импорт/экспорт календарных планов)
- Revit (BIM-интеграция)

### 8.2. Внешние системы
- Диадок/СБИС (обмен юридически значимыми документами)
- КриптоПро (наложение ЭЦП)
- API банков (мониторинг платежей)
- Порталы госзакупок (мониторинг тендеров)

## 9. Заключение

BLDR.EMPIRE представляет собой эволюционный подход к автоматизации строительных процессов, где:
- **Знания** — дообученные на российской нормативной базе локальные LLM-модели
- **Процессы** — 109 детализированных бизнес-процессов как основа архитектуры
- **Данные** — единая СОД с полной историей версий и метаданными
- **Документы** — автоматизированный ЭДО с поддержкой ГОСТ и законодательства РФ
- **Интеграции** — шлюзы к критически важным внешним системам

Архитектура специально спроектирована для того, чтобы начать с ключевых процессов (ТЭО, осмечивание, составление бюджетов), постепенно расширяясь до полной автоматизации всех сторон деятельности строительной организации, при этом сохраняя гибкость и адаптивность к изменениям в законодательстве и бизнес-модели.