<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yandex Browser MCP Test Page</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .test-section h3 {
            margin-top: 0;
            color: #ffd700;
        }
        
        button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        .status {
            background: rgba(0, 255, 0, 0.2);
            border: 1px solid #00ff00;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }
        
        .error {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid #ff0000;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }
        
        .info {
            background: rgba(0, 123, 255, 0.2);
            border: 1px solid #007bff;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }
        
        .log {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .card h4 {
            margin-top: 0;
            color: #ffd700;
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }
        
        .stat {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            min-width: 120px;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #ffd700;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Yandex Browser MCP Test Page</h1>
        
        <div class="status" id="connectionStatus">
            üîó –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MCP —Å–µ—Ä–≤–µ—Ä—É: <span id="statusText">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
        </div>
        
        <div class="stats">
            <div class="stat">
                <div class="stat-value" id="errorCount">0</div>
                <div class="stat-label">–û—à–∏–±–æ–∫ –∑–∞—Ö–≤–∞—á–µ–Ω–æ</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="sessionId">-</div>
                <div class="stat-label">Session ID</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="queueLength">0</div>
                <div class="stat-label">–í –æ—á–µ—Ä–µ–¥–∏</div>
            </div>
        </div>
        
        <div class="grid">
            <div class="card">
                <h4>üß™ –¢–µ—Å—Ç—ã JavaScript –æ—à–∏–±–æ–∫</h4>
                <button onclick="testReferenceError()">ReferenceError</button>
                <button onclick="testTypeError()">TypeError</button>
                <button onclick="testSyntaxError()">SyntaxError</button>
                <button onclick="testCustomError()">Custom Error</button>
            </div>
            
            <div class="card">
                <h4>üåê –¢–µ—Å—Ç—ã —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫</h4>
                <button onclick="testFetchError()">Fetch Error</button>
                <button onclick="testXHRError()">XHR Error</button>
                <button onclick="testTimeoutError()">Timeout Error</button>
                <button onclick="testCORS()">CORS Error</button>
            </div>
            
            <div class="card">
                <h4>üì¶ –¢–µ—Å—Ç—ã —Ä–µ—Å—É—Ä—Å–æ–≤</h4>
                <button onclick="testImageError()">Image Error</button>
                <button onclick="testScriptError()">Script Error</button>
                <button onclick="testCSSError()">CSS Error</button>
                <button onclick="testResourceError()">Resource Error</button>
            </div>
            
            <div class="card">
                <h4>‚ö° –¢–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</h4>
                <button onclick="testMemoryLeak()">Memory Leak</button>
                <button onclick="testLongTask()">Long Task</button>
                <button onclick="testDOMError()">DOM Error</button>
                <button onclick="testEventError()">Event Error</button>
            </div>
        </div>
        
        <div class="test-section">
            <h3>üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Å—Å–∏–∏</h3>
            <div class="info" id="sessionInfo">
                –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–µ—Å—Å–∏–∏...
            </div>
            <button onclick="refreshSessionInfo()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
        </div>
        
        <div class="test-section">
            <h3>üìù –õ–æ–≥ —Å–æ–±—ã—Ç–∏–π</h3>
            <div class="log" id="eventLog">
                –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è MCP –∫–ª–∏–µ–Ω—Ç–∞...
            </div>
            <button onclick="clearLog()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
        </div>
        
        <div class="test-section">
            <h3>üéØ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
            <button onclick="disconnectMCP()">üîå –û—Ç–∫–ª—é—á–∏—Ç—å—Å—è</button>
            <button onclick="reconnectMCP()">üîÑ –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</button>
            <button onclick="flushQueue()">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—á–µ—Ä–µ–¥—å</button>
            <button onclick="getErrorSummary()">üìä –°–≤–æ–¥–∫–∞ –æ—à–∏–±–æ–∫</button>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º MCP –∫–ª–∏–µ–Ω—Ç -->
    <script src="yandex-browser-client.js"></script>
    
    <script>
        let errorCount = 0;
        let eventLog = [];
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            logEvent('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            updateConnectionStatus();
            updateSessionInfo();
            
            // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
            setInterval(updateConnectionStatus, 5000);
            setInterval(updateSessionInfo, 10000);
        });
        
        function logEvent(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            eventLog.push(logEntry);
            
            const logElement = document.getElementById('eventLog');
            logElement.textContent = eventLog.slice(-20).join('\n');
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function updateConnectionStatus() {
            if (window.YandexBrowserMCP) {
                const sessionInfo = window.YandexBrowserMCP.getSessionInfo();
                const statusText = document.getElementById('statusText');
                const statusElement = document.getElementById('connectionStatus');
                
                if (sessionInfo.isConnected) {
                    statusText.textContent = '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ';
                    statusElement.className = 'status';
                } else {
                    statusText.textContent = '‚ùå –û—Ç–∫–ª—é—á–µ–Ω–æ';
                    statusElement.className = 'error';
                }
                
                document.getElementById('queueLength').textContent = sessionInfo.errorQueueLength;
            }
        }
        
        function updateSessionInfo() {
            if (window.YandexBrowserMCP) {
                const sessionInfo = window.YandexBrowserMCP.getSessionInfo();
                const sessionInfoElement = document.getElementById('sessionInfo');
                
                sessionInfoElement.innerHTML = `
                    <strong>Session ID:</strong> ${sessionInfo.sessionId}<br>
                    <strong>–°—Ç–∞—Ç—É—Å:</strong> ${sessionInfo.isConnected ? '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ' : '–û—Ç–∫–ª—é—á–µ–Ω–æ'}<br>
                    <strong>–û—à–∏–±–æ–∫ –≤ –æ—á–µ—Ä–µ–¥–∏:</strong> ${sessionInfo.errorQueueLength}<br>
                    <strong>User Agent:</strong> ${sessionInfo.browserInfo.userAgent}<br>
                    <strong>URL:</strong> ${sessionInfo.browserInfo.url}<br>
                    <strong>–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ:</strong> ${sessionInfo.browserInfo.screen.width}x${sessionInfo.browserInfo.screen.height}
                `;
            }
        }
        
        // –¢–µ—Å—Ç—ã –æ—à–∏–±–æ–∫
        function testReferenceError() {
            logEvent('üß™ –¢–µ—Å—Ç ReferenceError');
            try {
                console.log(undefinedVariable);
            } catch (error) {
                logEvent('‚úÖ ReferenceError –∑–∞—Ö–≤–∞—á–µ–Ω');
                errorCount++;
                document.getElementById('errorCount').textContent = errorCount;
            }
        }
        
        function testTypeError() {
            logEvent('üß™ –¢–µ—Å—Ç TypeError');
            try {
                null.someMethod();
            } catch (error) {
                logEvent('‚úÖ TypeError –∑–∞—Ö–≤–∞—á–µ–Ω');
                errorCount++;
                document.getElementById('errorCount').textContent = errorCount;
            }
        }
        
        function testSyntaxError() {
            logEvent('üß™ –¢–µ—Å—Ç SyntaxError');
            try {
                eval('function() {');
            } catch (error) {
                logEvent('‚úÖ SyntaxError –∑–∞—Ö–≤–∞—á–µ–Ω');
                errorCount++;
                document.getElementById('errorCount').textContent = errorCount;
            }
        }
        
        function testCustomError() {
            logEvent('üß™ –¢–µ—Å—Ç Custom Error');
            throw new Error('–¢–µ—Å—Ç–æ–≤–∞—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –æ—à–∏–±–∫–∞');
        }
        
        function testFetchError() {
            logEvent('üß™ –¢–µ—Å—Ç Fetch Error');
            fetch('/nonexistent-api-endpoint')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                })
                .catch(error => {
                    logEvent('‚úÖ Fetch Error –∑–∞—Ö–≤–∞—á–µ–Ω');
                    errorCount++;
                    document.getElementById('errorCount').textContent = errorCount;
                });
        }
        
        function testXHRError() {
            logEvent('üß™ –¢–µ—Å—Ç XHR Error');
            const xhr = new XMLHttpRequest();
            xhr.open('GET', '/nonexistent-api-endpoint');
            xhr.onerror = function() {
                logEvent('‚úÖ XHR Error –∑–∞—Ö–≤–∞—á–µ–Ω');
                errorCount++;
                document.getElementById('errorCount').textContent = errorCount;
            };
            xhr.send();
        }
        
        function testTimeoutError() {
            logEvent('üß™ –¢–µ—Å—Ç Timeout Error');
            setTimeout(() => {
                throw new Error('Timeout error simulation');
            }, 100);
        }
        
        function testCORS() {
            logEvent('üß™ –¢–µ—Å—Ç CORS Error');
            fetch('https://httpbin.org/status/500')
                .catch(error => {
                    logEvent('‚úÖ CORS Error –∑–∞—Ö–≤–∞—á–µ–Ω');
                    errorCount++;
                    document.getElementById('errorCount').textContent = errorCount;
                });
        }
        
        function testImageError() {
            logEvent('üß™ –¢–µ—Å—Ç Image Error');
            const img = new Image();
            img.onerror = function() {
                logEvent('‚úÖ Image Error –∑–∞—Ö–≤–∞—á–µ–Ω');
                errorCount++;
                document.getElementById('errorCount').textContent = errorCount;
            };
            img.src = '/nonexistent-image.jpg';
        }
        
        function testScriptError() {
            logEvent('üß™ –¢–µ—Å—Ç Script Error');
            const script = document.createElement('script');
            script.src = '/nonexistent-script.js';
            script.onerror = function() {
                logEvent('‚úÖ Script Error –∑–∞—Ö–≤–∞—á–µ–Ω');
                errorCount++;
                document.getElementById('errorCount').textContent = errorCount;
            };
            document.head.appendChild(script);
        }
        
        function testCSSError() {
            logEvent('üß™ –¢–µ—Å—Ç CSS Error');
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = '/nonexistent-style.css';
            link.onerror = function() {
                logEvent('‚úÖ CSS Error –∑–∞—Ö–≤–∞—á–µ–Ω');
                errorCount++;
                document.getElementById('errorCount').textContent = errorCount;
            };
            document.head.appendChild(link);
        }
        
        function testResourceError() {
            logEvent('üß™ –¢–µ—Å—Ç Resource Error');
            const iframe = document.createElement('iframe');
            iframe.src = '/nonexistent-page.html';
            iframe.onerror = function() {
                logEvent('‚úÖ Resource Error –∑–∞—Ö–≤–∞—á–µ–Ω');
                errorCount++;
                document.getElementById('errorCount').textContent = errorCount;
            };
            document.body.appendChild(iframe);
        }
        
        function testMemoryLeak() {
            logEvent('üß™ –¢–µ—Å—Ç Memory Leak');
            const leaks = [];
            for (let i = 0; i < 1000; i++) {
                leaks.push(new Array(1000).fill('memory leak test'));
            }
            logEvent('‚úÖ Memory Leak —Ç–µ—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω');
        }
        
        function testLongTask() {
            logEvent('üß™ –¢–µ—Å—Ç Long Task');
            const start = Date.now();
            while (Date.now() - start < 100) {
                // –ë–ª–æ–∫–∏—Ä—É—é—â–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
            }
            logEvent('‚úÖ Long Task —Ç–µ—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω');
        }
        
        function testDOMError() {
            logEvent('üß™ –¢–µ—Å—Ç DOM Error');
            try {
                document.getElementById('nonexistent').click();
            } catch (error) {
                logEvent('‚úÖ DOM Error –∑–∞—Ö–≤–∞—á–µ–Ω');
                errorCount++;
                document.getElementById('errorCount').textContent = errorCount;
            }
        }
        
        function testEventError() {
            logEvent('üß™ –¢–µ—Å—Ç Event Error');
            const button = document.createElement('button');
            button.addEventListener('click', function() {
                throw new Error('Event handler error');
            });
            button.click();
        }
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
        function refreshSessionInfo() {
            logEvent('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–µ—Å—Å–∏–∏');
            updateSessionInfo();
        }
        
        function clearLog() {
            logEvent('üóëÔ∏è –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–∞');
            eventLog = [];
            document.getElementById('eventLog').textContent = '';
        }
        
        function disconnectMCP() {
            logEvent('üîå –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç MCP —Å–µ—Ä–≤–µ—Ä–∞');
            if (window.YandexBrowserMCP) {
                window.YandexBrowserMCP.disconnect();
            }
        }
        
        function reconnectMCP() {
            logEvent('üîÑ –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MCP —Å–µ—Ä–≤–µ—Ä—É');
            if (window.YandexBrowserMCP) {
                window.YandexBrowserMCP.connect();
            }
        }
        
        function flushQueue() {
            logEvent('üì§ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ—á–µ—Ä–µ–¥–∏');
            if (window.YandexBrowserMCP) {
                window.YandexBrowserMCP.flushErrorQueue();
            }
        }
        
        function getErrorSummary() {
            logEvent('üìä –ó–∞–ø—Ä–æ—Å —Å–≤–æ–¥–∫–∏ –æ—à–∏–±–æ–∫');
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–≤–æ–¥–∫–∏
        }
    </script>
</body>
</html>
